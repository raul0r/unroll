<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ThreadKeeper</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div class="popup-container">
    <!-- Header -->
    <header class="header">
      <div class="header-content">
        <div class="logo">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z" stroke="currentColor" stroke-width="2"/>
            <path d="M17 21v-8H7v8M7 3v5h8" stroke="currentColor" stroke-width="2"/>
          </svg>
          <h1>ThreadKeeper</h1>
        </div>
        <div class="header-actions">
          <button id="settingsBtn" class="icon-btn" title="Settings">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <path d="M12 15a3 3 0 100-6 3 3 0 000 6z" stroke="currentColor" stroke-width="2"/>
              <path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z" stroke="currentColor" stroke-width="2"/>
            </svg>
          </button>
          <button id="openSidebarBtn" class="icon-btn" title="Open in sidebar">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <path d="M5 12h14M12 5l7 7-7 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
      </div>
      
      <!-- Stats Bar -->
      <div class="stats-bar">
        <div class="stat">
          <span class="stat-value" id="threadCount">0</span>
          <span class="stat-label">Threads</span>
        </div>
        <div class="stat">
          <span class="stat-value" id="tweetCount">0</span>
          <span class="stat-label">Tweets</span>
        </div>
        <div class="stat">
          <span class="stat-value" id="storageUsed">0 KB</span>
          <span class="stat-label">Storage</span>
        </div>
      </div>
    </header>

    <!-- Search Bar -->
    <div class="search-container">
      <div class="search-box">
        <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none">
          <path d="M11 19a8 8 0 100-16 8 8 0 000 16zM21 21l-4.35-4.35" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <input type="text" id="searchInput" placeholder="Search threads..." autocomplete="off">
        <button id="clearSearchBtn" class="clear-btn" style="display: none;">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
            <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </div>
      
      <!-- Filter Tabs -->
      <div class="filter-tabs">
        <button class="filter-tab active" data-filter="all">All</button>
        <button class="filter-tab" data-filter="recent">Recent</button>
        <button class="filter-tab" data-filter="collections">Collections</button>
        <button class="filter-tab" data-filter="tagged">Tagged</button>
      </div>
    </div>

    <!-- Thread List -->
    <div class="thread-list" id="threadList">
      <!-- Loading State -->
      <div class="loading-state" id="loadingState">
        <div class="spinner"></div>
        <p>Loading threads...</p>
      </div>
      
      <!-- Empty State -->
      <div class="empty-state" id="emptyState" style="display: none;">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none">
          <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z" stroke="currentColor" stroke-width="1.5"/>
          <path d="M17 21v-8H7v8M7 3v5h8" stroke="currentColor" stroke-width="1.5"/>
        </svg>
        <h3>No threads saved yet</h3>
        <p>Visit Twitter/X and click the save button on any thread to get started!</p>
        <button id="visitTwitterBtn" class="primary-btn">
          Visit Twitter
        </button>
      </div>
      
      <!-- Thread Items Container -->
      <div class="thread-items" id="threadItems"></div>
    </div>

    <!-- Footer Actions -->
    <footer class="footer">
      <button id="exportAllBtn" class="footer-btn">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
          <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        Export All
      </button>
      
      <div class="storage-indicator" id="storageIndicator">
        <div class="storage-bar">
          <div class="storage-fill" id="storageFill"></div>
        </div>
        <span class="storage-text" id="storageText">0/50 threads (Free)</span>
      </div>
      
      <button id="upgradeBtn" class="upgrade-btn" style="display: none;">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
          <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Upgrade to Pro
      </button>
    </footer>
  </div>

  <!-- Tag Management Modal -->
  <div id="tagModal" class="modal-overlay" style="display: none;">
    <div class="modal-container">
      <div class="modal-header">
        <h3>Manage Tags</h3>
        <button id="closeTagModal" class="modal-close-btn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
            <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </div>
      
      <div class="modal-content">
        <!-- Thread Info -->
        <div class="thread-info">
          <div class="thread-author-info">
            <img id="modalThreadAvatar" src="" alt="" class="modal-avatar">
            <div>
              <div id="modalThreadAuthor" class="modal-author-name"></div>
              <div id="modalThreadUsername" class="modal-author-username"></div>
            </div>
          </div>
        </div>
        
        <!-- Assigned Tags -->
        <div class="assigned-tags-section">
          <h4>Assigned Tags</h4>
          <div id="assignedTagsList" class="tags-list"></div>
        </div>
        
        <!-- Available Tags -->
        <div class="available-tags-section">
          <h4>Available Tags</h4>
          <div id="availableTagsList" class="tags-list"></div>
        </div>
        
        <!-- Create New Tag -->
        <div class="create-tag-section">
          <h4>Create New Tag</h4>
          <div class="create-tag-form">
            <input type="text" id="newTagName" placeholder="Tag name..." maxlength="50">
            <div class="color-picker">
              <input type="color" id="newTagColor" value="#1D9BF0">
              <span class="color-preview"></span>
            </div>
            <button id="createTagBtn" class="create-tag-btn">Create</button>
          </div>
        </div>
      </div>
      
      <div class="modal-footer">
        <button id="saveTagsBtn" class="primary-btn">Save Changes</button>
        <button id="cancelTagsBtn" class="secondary-btn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Thread Item Template -->
  <template id="threadItemTemplate">
    <div class="thread-item" data-thread-id="">
      <div class="thread-avatar">
        <img src="" alt="">
      </div>
      
      <div class="thread-content">
        <div class="thread-header">
          <div class="thread-author">
            <span class="author-name"></span>
            <span class="author-username"></span>
            <span class="verified-badge" style="display: none;">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="#1D9BF0">
                <path d="M22.5 12.5c0-1.58-.875-2.95-2.148-3.6.154-.435.238-.905.238-1.4 0-2.21-1.71-3.998-3.818-3.998-.47 0-.92.084-1.336.25C14.818 2.415 13.51 1.5 12 1.5s-2.816.917-3.437 2.25c-.415-.165-.866-.25-1.336-.25-2.11 0-3.818 1.79-3.818 4 0 .494.083.964.237 1.4-1.272.65-2.147 2.018-2.147 3.6 0 1.495.782 2.798 1.942 3.486-.02.17-.032.34-.032.514 0 2.21 1.708 4 3.818 4 .47 0 .92-.086 1.335-.25.62 1.334 1.926 2.25 3.437 2.25 1.512 0 2.818-.916 3.437-2.25.415.163.865.248 1.336.248 2.11 0 3.818-1.79 3.818-4 0-.174-.012-.344-.033-.513 1.158-.687 1.943-1.99 1.943-3.484zm-6.616-3.334l-4.334 6.5c-.145.217-.382.334-.625.334-.143 0-.288-.04-.416-.126l-.115-.094-2.415-2.415c-.293-.293-.293-.768 0-1.06s.768-.294 1.06 0l1.77 1.767 3.825-5.74c.23-.345.696-.436 1.04-.207.346.23.44.696.21 1.04z"/>
              </svg>
            </span>
          </div>
          <div class="thread-meta">
            <span class="thread-date"></span>
            <span class="thread-stats">
              <span class="tweet-count"></span> tweets
            </span>
          </div>
        </div>
        
        <div class="thread-preview"></div>
        
        <div class="thread-actions">
          <button class="action-btn view-btn" title="View thread">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="currentColor" stroke-width="2"/>
              <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
            </svg>
          </button>
          <button class="action-btn export-btn" title="Export thread">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
              <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3" stroke="currentColor" stroke-width="2"/>
            </svg>
          </button>
          <button class="action-btn tag-btn" title="Add tags">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
              <path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83 0L2 12V2h10l8.59 8.59a2 2 0 010 2.82zM7 7h.01" stroke="currentColor" stroke-width="2"/>
            </svg>
          </button>
          <button class="action-btn delete-btn" title="Delete thread">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
              <path d="M3 6h18M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2m3 0v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6h14zM10 11v6M14 11v6" stroke="currentColor" stroke-width="2"/>
            </svg>
          </button>
        </div>
        
        <div class="thread-tags"></div>
      </div>
    </div>
  </template>

  <script src="../lib/storage.js"></script>
  <script src="popup.js"></script>
</body>
</html>